<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter os="hidden" id="ch-entitlements">
 <title>Entitlements</title>
 <para>
  <remark>taroth 2011-02-01: the following is all about the RHN Satellite Entitlement and
  rhn-satellite-activate, see
  http://docs.redhat.com/docs/en-US/Red_Hat_Network_Satellite/5.4/html/Installation_Guide/ch-entitlements.html,
  commenting for now as we do not have a replacement yet</remark>
  <remark>taroth 2011-02-10: todo for next revision - see also https://bugzilla.novell.com/show_bug.cgi?id=670003#c8</remark>
 </para>
<!--<indexterm>
 <primary>RHN Entitlement<!-\- [GALAXY] 'Entitlement' -\-> Certificates</primary></indexterm>-->
 <para os="hidden">
  The RHN Satellite
<!-- [GALAXY] '&susemgr;' -->
  , like RHN itself, provides all services to customers through the setting
  of entitlements. For RHN, entitlements are purchased by customers as
  needed; however, for RHN Satellite
<!-- [GALAXY] '&susemgr;' -->
  , entitlements are contractually agreed-upon beforehand, and they are set
  at installation time. All <emphasis>public</emphasis> channels are
  automatically available; the private channels that should also be made
  available through the Satellite are determined by the <emphasis>RHN
  Entitlement
<!-- [GALAXY] 'Entitlement' -->
  Certificate</emphasis>.
 </para>
 <para os="hidden">
  The RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
  Certificate, which contains the precise set of entitlements attributed to
  your organization, is provided by your Red Hat representative. Red Hat
  reserves the right to compare the contents of that RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
  Certificate with the database's entitlement
<!-- [GALAXY] 'Entitlement' -->
  settings at any time to ensure compliance with the terms of the customer's
  contract with Red Hat.
 </para>
 <para os="hidden">
  The steps referenced in this section are typically carried out by the RHN
  Satellite
<!-- [GALAXY] '&susemgr;' -->
  Installation Program itself and do not need to be repeated during initial
  installation. Instead, they are listed here for use by customers who have
  received a new RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
  Certificate, such as one reflecting an increase in the number of
  entitlements.
 </para>
 <sect1 os="hidden" id="s1-entitlements-receiving-cert">
<!--status="notrevised"-->

  <title>Receiving the Certificate</title><indexterm>

  <primary>Red Hat Network</primary>

  <secondary>receiving</secondary></indexterm>

  <para>
   The RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate is an XML document that looks something like this:
  </para>

<screen>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;rhn-cert version=&quot;0.1&quot;&gt;
  &lt;rhn-cert-field name=&quot;product&quot;&gt;RHN-SATELLITE-001&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;owner&quot;&gt;Clay's Precious Satellite&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;issued&quot;&gt;2005-01-11 00:00:00&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;expires&quot;&gt;2005-03-11 00:00:00&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;slots&quot;&gt;30&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;provisioning-slots&quot;&gt;30&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;nonlinux-slots&quot;&gt;30&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;10&quot; family=&quot;rhel-cluster&quot;/&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;30&quot; family=&quot;rhel-ws-extras&quot;/&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;10&quot; family=&quot;rhel-gfs&quot;/&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;10&quot; family=&quot;rhel-es-extras&quot;/&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;40&quot; family=&quot;rhel-as&quot;/&gt;
  &lt;rhn-cert-field name=&quot;channel-families&quot; quantity=&quot;30&quot; family=&quot;rhn-tools&quot;/&gt;
  &lt;rhn-cert-field name=&quot;satellite-version&quot;&gt;5.2&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-field name=&quot;generation&quot;&gt;2&lt;/rhn-cert-field&gt;
  &lt;rhn-cert-signature&gt;
-----BEGIN PGP SIGNATURE-----
Version: Crypt::OpenPGP 1.03

iQBGBAARAwAGBQJCAG7yAAoJEJ5yna8GlHkysOkAn07qmlUrkGKs7/5yb8H/nboG
mhHkAJ9wdmqOeKfcBa3IUDL53oNMEBP/dg==
=0Kv7
-----END PGP SIGNATURE-----
&lt;/rhn-cert-signature&gt;
&lt;/rhn-cert&gt;</screen>

  <note>
   <para>
    Do not try to use this RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Certificate; it is just an example.
   </para>
  </note>

  <para>
   The initial RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate is generated by a member of the RHN team and emailed to a
   consultant or customer prior to installation. This process helps
   guarantee that we do not inadvertently install any RHN Satellites that
   the RHN team does not know about.
  </para>

  <para>
   Save the XML file to the Satellite machine in preparation for activation.
  </para>
 </sect1>
 <sect1 os="hidden" id="s1-entitlements-website">
<!--status="notrevised"-->

  <title>Uploading the RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate</title><indexterm>

  <primary>embedded database</primary>

  <secondary>uploading</secondary></indexterm>

  <para>
   If your RHN Satellite
<!-- [GALAXY] '&susemgr;' -->
   is connected to the Internet, you have the option of uploading your new
   RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate through the RHN website. To do this:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Log into <ulink url="https://rhn.redhat.com"/> with your organization's
     Satellite-entitled account.
    </para>
   </listitem>
   <listitem>
    <para>
     Click <guimenu>Systems</guimenu> in the top navigation bar and then the
     name of the RHN Satellite. You may also find the Satellite through the
     Satellite line item within the <guimenu>Channels</guimenu> category.
    </para>
   </listitem>
   <listitem>
    <para>
     In the <guimenu>System Details</guimenu> page, click the
     <guimenu>Satellite</guimenu> subtab and examine the existing
     certificate. Ensure you have a backup of this file by copying and
     pasting its contents into a text editor.
    </para>
   </listitem>
   <listitem>
    <para>
     Click <guimenu>Deactivate Satellite License</guimenu> at the bottom of
     the page. Then click <guimenu>Confirm Deactivation</guimenu>. You will
     receive a message describing the deactivation at the top of the page.
    </para>
   </listitem>
   <listitem>
    <para>
     You may then browse to the location of your new RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
     Certificate or paste its contents into the text field provided. When
     done, click <guimenu>Update Certificate</guimenu>.
    </para>
   </listitem>
  </orderedlist>

  <para>
   Your Satellite now has access to additional channels and client
   entitlements outlined in the new certificate. You may now synchronize it
   with the central RHN Servers. Refer to <xref linkend="ch-import-sync"/>.
  </para>
 </sect1>
 <sect1 os="hidden" id="s1-entitlements-validating">
<!--status="notrevised"-->

  <title>Managing the RHN Certificate with RHN Satellite
<!-- [GALAXY] '&susemgr;' -->
   Activate</title><indexterm>

  <primary>RHN Satellite<!-- [GALAXY] '&susemgr;' --> Activate </primary></indexterm><indexterm>

  <primary>rhn-satellite-activate </primary></indexterm><indexterm>

  <primary>rhns-satellite-tools </primary></indexterm>

  <para>
   For disconnected Satellites or customers who prefer to work locally, Red
   Hat provides a command line tool for managing your RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate and activating the Satellite using that certificate: RHN
   Satellite
<!-- [GALAXY] '&susemgr;' -->
   Activate (<command>rhn-satellite-activate</command>). This is included
   with the Satellite installation as part of the
   <filename>rhns-satellite-tools</filename> package.
  </para>

  <sect2 id="s2-entitlements-options">
<!--status="notrevised"-->
   <title>Command Line Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Options</title><indexterm>
   <primary>Red Hat Network</primary>
   <secondary>options</secondary></indexterm><indexterm>
   <primary>Red Hat Network</primary>
   <secondary>options</secondary></indexterm>
   <para>
    The <filename>rhn-satellite-activate</filename> tool offers a handful of
    command line options for activating a Satellite using its RHN
    Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Certificate:
   </para>
   <table id="tb-cert-entitlement-options">
    <title>RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
     Certificate Options</title>
    <tgroup cols="2">
     <thead>
      <row>
       <entry>
        <para>
         Option
        </para>
       </entry>
       <entry>
        <para>
         Description
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         <option>-h</option>, <option>--help</option>
        </para>
       </entry>
       <entry>
        <para>
         Display the help screen with a list of options.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <option>--sanity-only</option>
        </para>
       </entry>
       <entry>
        <para>
         Confirm certificate sanity. Does not activate the Satellite locally
         or remotely.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <option>--disconnected</option>
        </para>
       </entry>
       <entry>
        <para>
         Activates locally but not on remote RHN Servers.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <option>--rhn-cert=<replaceable>/PATH/TO/CERT</replaceable></option>
        </para>
       </entry>
       <entry>
        <para>
         Uploads new certificate and activates the Satellite based upon the
         other options passed (if any).
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <option>--systemid=<replaceable>/PATH/TO/SYSTEMID</replaceable></option>
        </para>
       </entry>
       <entry>
        <para>
         <emphasis>For testing only</emphasis> - Provides an alternative
         system ID by path and file. The system default is used if not
         specified.
        </para>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         <option>--no-ssl</option>
        </para>
       </entry>
       <entry>
        <para>
         <emphasis>For testing only</emphasis> - Disable SSL.
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
   <para>
    To use these options, insert the option and the appropriate value, if
    needed, after the <command>rhn-satellite-activate</command> command.
    Refer to <xref linkend="s2-activate-sat-cert"/>.
   </para>
  </sect2>

  <sect2 id="s2-activate-sat-cert">
<!--status="notrevised"-->
   <title>Activating the Satellite</title><indexterm>
   <primary>Red Hat Network</primary>
   <secondary>activating</secondary></indexterm>
   <para>
    You should use the options in
    <xref linkend="tb-cert-entitlement-options"/> to accomplish the
    following tasks in this order:
   </para>
   <orderedlist>
    <listitem>
     <para>
      Validate the RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
      Certificate's sanity (or usefulness).
     </para>
    </listitem>
    <listitem>
     <para>
      Activate the Satellite locally by inserting the RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
      Certificate into the local database.
     </para>
    </listitem>
    <listitem>
     <para>
      Activate the Satellite remotely by inserting the RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
      Certificate into the central RHN (remote) database. This is typically
      accomplished during local activation but may require a second step if
      you chose the <option>--disconnected</option> option.
     </para>
    </listitem>
   </orderedlist>
   <para>
    Here are some examples depicting use of the tool and these options.
   </para>
   <para>
    To validate an RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Certificate's sanity only:
   </para>
<screen>
rhn-satellite-activate --sanity-only --rhn-cert=<replaceable>/path/to/demo.cert</replaceable>
</screen>
   <para>
    To validate an RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Certificate and populate the local database:
   </para>
<screen>
rhn-satellite-activate --disconnected --rhn-cert=<replaceable>/path/to/demo.cert</replaceable>
</screen>
   <para>
    To validate an RHN Entitlement
<!-- [GALAXY] 'Entitlement' -->
    Certificate and populate both the local and the RHN database:
   </para>
<screen>
rhn-satellite-activate --rhn-cert=<replaceable>/path/to/demo.cert</replaceable>
</screen>
   <para>
    Once you run this final command, the Satellite is running and able to
    serve packages locally and synchronize with the central RHN Servers.
    Refer to <xref linkend="ch-import-sync"/>.
   </para>
  </sect2>
 </sect1>
 <sect1 os="hidden" id="entitlements-deactivate">
<!--status="notrevised"-->

  <title>Satellite Entitlement
<!-- [GALAXY] 'Entitlement' -->
   Certificate Expiration</title>

  <para>
   Satellite certificates expire at 11:59:59 PM on the date listed in the
   certificate's <guimenu>expires</guimenu> field, and new certificates
   become active at 12:00:00 AM on their <guimenu>issued</guimenu> date.
  </para>

  <para>
   A standard grace period of seven (7) days exists between the date of
   Satellite certificate expiration and when the Satellite becomes inactive.
   This grace period is provided in order for customers to contact Red Hat
   Support and obtain a new certificate. During the grace period, the
   following things happen:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     The Satellite remains active.
    </para>
   </listitem>
   <listitem>
    <para>
     Each user that logs into the Satellite sees a banner on their
     <guimenu>Your RHN</guimenu> page that explains that the Satellite
     certificate has expired.
    </para>
   </listitem>
   <listitem>
    <para>
     Once a day, for all seven days, the Satellite Administrator's email
     receives notification that the certificate has expired.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   When the grace period is over, the Satellite becomes unavailable: users
   will be unable to login to the web UI and all client-side tools will
   present an <guimenu>Expired Certificate</guimenu> message.
  </para>

  <para>
   Finally, the Satellite Administrator receives a daily email alerting them
   that the certificate has expired.
  </para>
 </sect1>
</chapter>
