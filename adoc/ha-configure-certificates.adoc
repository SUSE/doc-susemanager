= Configure Certificates
include::entities.adoc[]

In this section you will create and configure a new {rootuser} CA.

== Create the New Root CA

. Start the yast CA module:
+

----
yast ca_mgm
----

. Create new Root CA pressing kbd:[alt+shift+C].
+

image::33-1.png[Start the YaST CA Module, scaledwidth=80%]

. Enter your custom CA info.

. Enter a password (do not lose this password!)
+

image::33-2.png[New CA Password, scaledwidth=80%]

. Verify your CA data is correct and then create it.
+

image::33-3.png[Verify CA Data, scaledwidth=80%]

. The new rootca can be found in `var/lib/CAM/suma`. Verify the cert with:
+
----
openssl x509 -in cacert.pem -text
----

. Create a new directory called `/root/certs`

. Copy the certificate to the new directory:
+
----
cp /var/lib/CAM/suma/cacert.pem /root/certs
----

== Create the Server Certificate

. Start the yast CA module:
+

----
yast ca_mgm
----
+

image::33-4.png[Start YaST CA Module, scaledwidth=80%]

. Enter CA by typing your CA password:
+

image::33-5.png[Enter CA, scaledwidth=80%]

. At the Certificate Data Screen select *OK*.
+
image::33-6.png[CA Data Screen, scaledwidth=80%]

. At the Certificate Authority (CA) screen you will *Add a Server certificate*.
+

image::33-7.png[Certificate Authority Screen, scaledwidth=80%]

. Press kbd:[alt+shift+a] to add a new server certificate:
+

image::33-8.png[scaledwidth=80%]

. At the *Create New Server Certificate* screen enter a name and the hostname select *Next*.
+

image::33-9.png[New Server Certificate Step 1, scaledwidth=80%]

. Ensure *Use CA Password as Certificate Password* is selected then select *Next* to continue.
+

image::33-10.png[Create New Server Certificate Step 2, scaledwidth=80%]

. Enter the *Advanced Options* by pressing kbd:[alt+shift+a]. Under *Advanced Settings* select *Subject Alt Name*.
+

image::33-11.png[scaledwidth=80%]

. Add the alt names for each of your nodes to the Server Certificate:
+

image::33-12.png[Add Alt Names, scaledwidth=80%]

. Your result should be similar to the following image:
+

image::33-13.png[Final Alt Names, scaledwidth=80%]

. Export the CA, Server Certificate, and Server Key:

.. Place the Certificate for PEM → `/root/certs/server_cert.pem`
.. Place the unencrypted key for PEM → `/root/certs/server_key.pem`

. Copy `/root/certs/cacert.pem` to `/etc/pki/trust/anchors` and run the following command on both servers:
+

----
 /usr/sbin/update-ca-certificates
----

[NOTE]
====
Make a copy of `/var/lib/CAM/suma`. This will act as a backup.
====

In the next step you will install SUSE Manager on *node1*
